{"ast":null,"code":"var _process$env$REACT_AP;\n/**\n * è®¤è¯æœåŠ¡\n * å¤„ç†ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€ä»¤ç‰Œç®¡ç†ç­‰åŠŸèƒ½\n * å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶\n */\n\nimport axios from 'axios';\nimport { message } from 'antd';\nimport { tokenManager } from './api';\n\n// è®¤è¯APIåŸºç¡€URL\n// const AUTH_API_URL = 'http://localhost:5000/api/auth';\n\n// å°†ç¡¬ç¼–ç URLæ”¹ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡\nconst AUTH_API_URL = ((_process$env$REACT_AP = process.env.REACT_APP_API_BASE_URL) === null || _process$env$REACT_AP === void 0 ? void 0 : _process$env$REACT_AP.replace('/api', '/api/auth')) || 'http://localhost:5000/api/auth';\n\n// æœ¬åœ°å­˜å‚¨é”®\nconst USER_INFO_KEY = 'userInfo';\nconst AUTH_LAST_VERIFIED_KEY = 'auth_last_verified';\n\n// é…ç½®å¸¸é‡\nconst REQUEST_TIMEOUT = 15000; // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\nconst MAX_RETRY_COUNT = 2; // æœ€å¤§é‡è¯•æ¬¡æ•°\nconst RETRY_DELAY = 1000; // é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰\n\n// åˆ›å»ºè®¤è¯ä¸“ç”¨çš„ axios å®ä¾‹\nconst authApi = axios.create({\n  baseURL: AUTH_API_URL,\n  timeout: REQUEST_TIMEOUT,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// è¯·æ±‚é‡è¯•å‡½æ•°\nconst retryAuthRequest = async (config, retryCount = 0) => {\n  try {\n    return await axios(config);\n  } catch (error) {\n    // åªæœ‰åœ¨ç½‘ç»œé”™è¯¯æˆ–5xxæœåŠ¡å™¨é”™è¯¯æ—¶é‡è¯•\n    const isNetworkError = !error.response;\n    const isServerError = error.response && error.response.status >= 500;\n    if ((isNetworkError || isServerError) && retryCount < MAX_RETRY_COUNT) {\n      console.log(`è®¤è¯è¯·æ±‚å¤±è´¥ï¼Œ${RETRY_DELAY / 1000}ç§’åé‡è¯• (${retryCount + 1}/${MAX_RETRY_COUNT})`);\n      await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\n      return retryAuthRequest(config, retryCount + 1);\n    }\n    throw error;\n  }\n};\n\n// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ - è‡ªåŠ¨æ·»åŠ tokenåˆ°è¯·æ±‚å¤´\nauthApi.interceptors.request.use(config => {\n  const token = tokenManager.getToken();\n  if (token) {\n    config.headers = config.headers || {};\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n\n  // æ·»åŠ è¯·æ±‚æ—¶é—´æˆ³ï¼Œç”¨äºè°ƒè¯•\n  config.headers = config.headers || {};\n  config.headers['X-Request-Time'] = new Date().toISOString();\n\n  // è®°å½•è¯·æ±‚ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰\n  if (process.env.NODE_ENV === 'development') {\n    var _config$method;\n    console.log(`ğŸ” è®¤è¯è¯·æ±‚: ${(_config$method = config.method) === null || _config$method === void 0 ? void 0 : _config$method.toUpperCase()} ${config.url}`, {\n      headers: {\n        ...config.headers,\n        Authorization: token ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'\n      },\n      data: config.data,\n      params: config.params\n    });\n  }\n  return config;\n}, error => {\n  console.error('è®¤è¯è¯·æ±‚æ‹¦æˆªå™¨é”™è¯¯:', error);\n  return Promise.reject(error);\n});\n\n// æ·»åŠ å“åº”æ‹¦æˆªå™¨ - å¤„ç†tokenè¿‡æœŸ\nauthApi.interceptors.response.use(response => {\n  // è®°å½•å“åº”ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰\n  if (process.env.NODE_ENV === 'development') {\n    var _response$config$meth;\n    console.log(`âœ… è®¤è¯å“åº”æˆåŠŸ: ${(_response$config$meth = response.config.method) === null || _response$config$meth === void 0 ? void 0 : _response$config$meth.toUpperCase()} ${response.config.url}`, {\n      status: response.status,\n      data: response.data\n    });\n  }\n  return response;\n}, error => {\n  // è·å–è¯·æ±‚é…ç½®å’Œå“åº”\n  const {\n    config,\n    response\n  } = error;\n\n  // è®°å½•é”™è¯¯ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰\n  if (process.env.NODE_ENV === 'development') {\n    var _config$method2;\n    console.error(`âŒ è®¤è¯è¯·æ±‚å¤±è´¥: ${config === null || config === void 0 ? void 0 : (_config$method2 = config.method) === null || _config$method2 === void 0 ? void 0 : _config$method2.toUpperCase()} ${config === null || config === void 0 ? void 0 : config.url}`, {\n      status: response === null || response === void 0 ? void 0 : response.status,\n      data: response === null || response === void 0 ? void 0 : response.data,\n      error: error.message\n    });\n  }\n\n  // å¤„ç†401é”™è¯¯ï¼ˆæœªæˆæƒï¼Œé€šå¸¸æ˜¯tokenè¿‡æœŸæˆ–æ— æ•ˆï¼‰\n  if ((response === null || response === void 0 ? void 0 : response.status) === 401) {\n    console.warn('è®¤è¯è¯·æ±‚æ”¶åˆ°401æœªæˆæƒå“åº”');\n\n    // æ¸…é™¤è®¤è¯ç›¸å…³æ•°æ®\n    tokenManager.removeToken();\n    localStorage.removeItem(USER_INFO_KEY);\n    localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n\n    // å¦‚æœä¸æ˜¯éªŒè¯æ¥å£çš„è¯·æ±‚ï¼Œæ˜¾ç¤ºæç¤ºå¹¶é‡å®šå‘\n    if ((config === null || config === void 0 ? void 0 : config.url) !== '/verify') {\n      message.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');\n\n      // ä½¿ç”¨å»¶è¿Ÿé‡å®šå‘ï¼Œç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿæ˜¾ç¤º\n      setTimeout(() => {\n        // ä¿å­˜å½“å‰URLï¼Œä»¥ä¾¿ç™»å½•åè¿”å›\n        const currentPath = window.location.pathname;\n        if (currentPath !== '/login') {\n          sessionStorage.setItem('redirectAfterLogin', currentPath);\n        }\n        window.location.href = '/login';\n      }, 1500);\n    }\n  }\n  return Promise.reject(error);\n});\n\n// ç”¨æˆ·æ•°æ®ç±»å‹\n\n// ç™»å½•è¯·æ±‚æ•°æ®\n\n// æ³¨å†Œè¯·æ±‚æ•°æ®\n\n// è®¤è¯å“åº”æ•°æ®\n\n// API å“åº”æ ¼å¼\n\n// è®¤è¯æœåŠ¡ç±»\nexport class AuthService {\n  /**\n   * ç”¨æˆ·æ³¨å†Œ\n   */\n  async register(userData) {\n    try {\n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      const response = await retryAuthRequest({\n        method: 'post',\n        url: `${AUTH_API_URL}/register`,\n        data: userData,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      const data = response.data;\n      if (data.success && data.data) {\n        // ä¿å­˜ä»¤ç‰Œ - åç«¯è¿”å›çš„æ˜¯tokenå­—æ®µ\n        tokenManager.setToken(data.data.token);\n\n        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯æ—¶é—´\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        message.success('æ³¨å†ŒæˆåŠŸï¼');\n        return data;\n      } else {\n        message.error(data.message || 'æ³¨å†Œå¤±è´¥');\n        return data;\n      }\n    } catch (error) {\n      var _error$response, _error$response2, _error$response2$data;\n      console.error('æ³¨å†Œå¤±è´¥:', ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n\n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        const errorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';\n        message.error(errorMessage);\n        return {\n          success: false,\n          message: errorMessage,\n          networkError: true\n        };\n      }\n      const errorMessage = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•';\n      message.error(errorMessage);\n      return {\n        success: false,\n        message: errorMessage,\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * ç”¨æˆ·ç™»å½•\n   */\n  async login(credentials) {\n    try {\n      console.log('å¼€å§‹ç™»å½•è¯·æ±‚:', credentials);\n      console.log('API URL:', AUTH_API_URL);\n\n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      const response = await retryAuthRequest({\n        method: 'post',\n        url: `${AUTH_API_URL}/login`,\n        data: credentials,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      console.log('ç™»å½•å“åº”:', response.data);\n      const data = response.data;\n      if (data.success && data.data) {\n        // ä¿å­˜ä»¤ç‰Œåˆ°localStorage - åç«¯è¿”å›çš„æ˜¯tokenå­—æ®µ\n        tokenManager.setToken(data.data.token);\n\n        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯æ—¶é—´\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n\n        // æ£€æŸ¥æ˜¯å¦æœ‰ç™»å½•åé‡å®šå‘è·¯å¾„\n        const redirectPath = sessionStorage.getItem('redirectAfterLogin');\n        if (redirectPath) {\n          console.log(`ç™»å½•æˆåŠŸï¼Œå°†é‡å®šå‘åˆ°: ${redirectPath}`);\n          sessionStorage.removeItem('redirectAfterLogin');\n        }\n        message.success('ç™»å½•æˆåŠŸï¼');\n        return data;\n      } else {\n        console.error('ç™»å½•å¤±è´¥:', data.message);\n        message.error(data.message || 'ç™»å½•å¤±è´¥');\n        return data;\n      }\n    } catch (error) {\n      var _error$response3, _error$response4, _error$response5, _error$response5$data;\n      console.error('ç™»å½•è¯·æ±‚å¼‚å¸¸:', error);\n      console.error('é”™è¯¯å“åº”:', (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.data);\n\n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        const errorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';\n        message.error(errorMessage);\n        return {\n          success: false,\n          message: errorMessage,\n          networkError: true\n        };\n      }\n\n      // å¤„ç†ç‰¹å®šé”™è¯¯\n      if (((_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.status) === 401) {\n        const errorMessage = 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯';\n        message.error(errorMessage);\n        return {\n          success: false,\n          message: errorMessage,\n          error: error.message\n        };\n      }\n      const errorMessage = ((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : (_error$response5$data = _error$response5.data) === null || _error$response5$data === void 0 ? void 0 : _error$response5$data.message) || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•';\n      message.error(errorMessage);\n      return {\n        success: false,\n        message: errorMessage,\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * éªŒè¯ä»¤ç‰Œ\n   */\n  async verifyToken() {\n    try {\n      const token = tokenManager.getToken();\n      if (!token) {\n        console.log('æ²¡æœ‰æ‰¾åˆ°tokenï¼Œæ— æ³•éªŒè¯');\n        return {\n          success: false\n        };\n      }\n      console.log('å¼€å§‹éªŒè¯token...', token.substring(0, 15) + '...');\n      console.log('Tokenæ ¼å¼æ£€æŸ¥:', token.split('.').length === 3 ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ');\n\n      // ç›´æ¥æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ\n      if (!tokenManager.isAuthenticated()) {\n        console.warn('æœ¬åœ°tokenéªŒè¯å¤±è´¥ï¼Œå¯èƒ½å·²è¿‡æœŸ');\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n        return {\n          success: false\n        };\n      }\n\n      // æ£€æŸ¥æ˜¯å¦æœ‰æœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯\n      const storedUserInfo = localStorage.getItem(USER_INFO_KEY);\n      let localUser = null;\n      if (storedUserInfo) {\n        try {\n          localUser = JSON.parse(storedUserInfo);\n          console.log('ä»æœ¬åœ°å­˜å‚¨æ¢å¤ç”¨æˆ·ä¿¡æ¯:', localUser);\n        } catch (e) {\n          console.error('è§£ææœ¬åœ°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);\n        }\n      }\n\n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      console.log(`å‘é€éªŒè¯è¯·æ±‚åˆ°: ${AUTH_API_URL}/verify`);\n      const response = await retryAuthRequest({\n        method: 'get',\n        url: `${AUTH_API_URL}/verify`,\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        timeout: 5000 // é™ä½è¶…æ—¶æ—¶é—´ï¼ŒåŠ å¿«éªŒè¯é€Ÿåº¦\n      });\n\n      // è¯·æ±‚æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨æ·»åŠ Authorizationå¤´\n      const data = response.data;\n      console.log('éªŒè¯å“åº”:', data);\n      if (data.success && data.data && data.data.user) {\n        console.log('TokenéªŒè¯æˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯:', data.data.user);\n\n        // æ›´æ–°éªŒè¯æ—¶é—´å’Œç”¨æˆ·ä¿¡æ¯\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        return {\n          success: true,\n          user: data.data.user\n        };\n      } else {\n        console.log('TokenéªŒè¯å¤±è´¥ï¼ŒæœåŠ¡å™¨è¿”å›:', data);\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n        return {\n          success: false\n        };\n      }\n    } catch (error) {\n      var _error$response6, _error$response7;\n      console.error('ä»¤ç‰ŒéªŒè¯å¤±è´¥:', error);\n      console.error('é”™è¯¯çŠ¶æ€ç :', (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.status);\n      console.error('é”™è¯¯è¯¦æƒ…:', (_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : _error$response7.data);\n\n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        console.warn('éªŒè¯token: ç½‘ç»œé”™è¯¯ï¼Œæ£€æŸ¥æœ¬åœ°ç”¨æˆ·ä¿¡æ¯');\n\n        // ç½‘ç»œé”™è¯¯æ—¶ï¼Œå¦‚æœæœ‰æœ¬åœ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°è¯•ä½¿ç”¨æœ¬åœ°ä¿¡æ¯\n        const storedUserInfo = localStorage.getItem(USER_INFO_KEY);\n        if (storedUserInfo && tokenManager.isAuthenticated()) {\n          try {\n            const user = JSON.parse(storedUserInfo);\n            console.log('ç½‘ç»œé”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:', user);\n            return {\n              success: true,\n              user: user,\n              networkError: true\n            };\n          } catch (e) {\n            console.error('è§£ææœ¬åœ°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);\n          }\n        }\n        return {\n          success: false,\n          networkError: true\n        };\n      }\n\n      // æ¸…é™¤æ— æ•ˆçš„tokenï¼ˆé™¤éæ˜¯ç½‘ç»œé”™è¯¯ï¼‰\n      if (!isNetworkError) {\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      }\n      return {\n        success: false\n      };\n    }\n  }\n\n  /**\n   * è·å–ç”¨æˆ·èµ„æ–™\n   */\n  async getProfile() {\n    try {\n      const token = tokenManager.getToken();\n      if (!token) {\n        return {\n          success: false\n        };\n      }\n\n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      const response = await retryAuthRequest({\n        method: 'get',\n        url: `${AUTH_API_URL}/profile`,\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      // è¯·æ±‚æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨æ·»åŠ Authorizationå¤´\n      const data = response.data;\n      if (data.success && data.data && data.data.user) {\n        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯æ—¶é—´\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        return {\n          success: true,\n          user: data.data.user\n        };\n      } else {\n        return {\n          success: false\n        };\n      }\n    } catch (error) {\n      var _error$response8;\n      console.error('è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', error);\n\n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        return {\n          success: false,\n          networkError: true\n        };\n      }\n\n      // å¦‚æœæ˜¯401é”™è¯¯ï¼Œæ¸…é™¤è®¤è¯çŠ¶æ€\n      if (((_error$response8 = error.response) === null || _error$response8 === void 0 ? void 0 : _error$response8.status) === 401) {\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      }\n      return {\n        success: false\n      };\n    }\n  }\n\n  /**\n   * ç”¨æˆ·ç™»å‡º\n   */\n  async logout() {\n    try {\n      const token = tokenManager.getToken();\n      if (token) {\n        try {\n          // å¯é€‰ï¼šè°ƒç”¨åç«¯ç™»å‡ºæ¥å£\n          await authApi.post('/logout');\n          // æ³¨æ„ï¼šç”±äºæ·»åŠ äº†è¯·æ±‚æ‹¦æˆªå™¨ï¼Œè¿™é‡Œä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ Authorizationå¤´\n          console.log('æˆåŠŸè°ƒç”¨ç™»å‡ºAPI');\n        } catch (error) {\n          console.warn('ç™»å‡ºAPIè°ƒç”¨å¤±è´¥ï¼Œä½†ä¼šç»§ç»­æ¸…é™¤æœ¬åœ°çŠ¶æ€:', error);\n        }\n      }\n\n      // æ— è®ºå¦‚ä½•éƒ½è¦æ¸…é™¤æœ¬åœ°ä»¤ç‰Œå’Œç”¨æˆ·ä¿¡æ¯\n      tokenManager.removeToken();\n      localStorage.removeItem(USER_INFO_KEY);\n      localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      return {\n        success: true,\n        message: 'å·²å®‰å…¨é€€å‡ºç™»å½•'\n      };\n    } catch (error) {\n      console.error('ç™»å‡ºè¿‡ç¨‹å‡ºé”™:', error);\n\n      // å³ä½¿å‡ºé”™ï¼Œä¹Ÿè¦å°è¯•æ¸…é™¤æœ¬åœ°çŠ¶æ€\n      try {\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      } catch (e) {\n        console.error('æ¸…é™¤æœ¬åœ°çŠ¶æ€å¤±è´¥:', e);\n      }\n      return {\n        success: false,\n        message: 'ç™»å‡ºè¿‡ç¨‹å‡ºé”™ï¼Œä½†å·²æ¸…é™¤æœ¬åœ°ç™»å½•çŠ¶æ€'\n      };\n    }\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦å·²è®¤è¯\n   */\n  isAuthenticated() {\n    return tokenManager.isAuthenticated();\n  }\n\n  /**\n   * æ£€æŸ¥è®¤è¯çŠ¶æ€ï¼ˆæœ¬åœ°æ£€æŸ¥ï¼Œä¸å‘é€ç½‘ç»œè¯·æ±‚ï¼‰\n   */\n  checkAuthStatus() {\n    const isAuthenticated = this.isAuthenticated();\n    let user = null;\n\n    // å¦‚æœæœ‰tokenï¼Œå°è¯•ä»localStorageè·å–ç”¨æˆ·ä¿¡æ¯\n    if (isAuthenticated) {\n      try {\n        const userInfo = localStorage.getItem(USER_INFO_KEY);\n        if (userInfo) {\n          user = JSON.parse(userInfo);\n        }\n      } catch (e) {\n        console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);\n      }\n    }\n    return {\n      isAuthenticated,\n      user\n    };\n  }\n}\nexport const authService = new AuthService();","map":{"version":3,"names":["axios","message","tokenManager","AUTH_API_URL","_process$env$REACT_AP","process","env","REACT_APP_API_BASE_URL","replace","USER_INFO_KEY","AUTH_LAST_VERIFIED_KEY","REQUEST_TIMEOUT","MAX_RETRY_COUNT","RETRY_DELAY","authApi","create","baseURL","timeout","headers","retryAuthRequest","config","retryCount","error","isNetworkError","response","isServerError","status","console","log","Promise","resolve","setTimeout","interceptors","request","use","token","getToken","Authorization","Date","toISOString","NODE_ENV","_config$method","method","toUpperCase","url","data","params","reject","_response$config$meth","_config$method2","warn","removeToken","localStorage","removeItem","currentPath","window","location","pathname","sessionStorage","setItem","href","AuthService","register","userData","success","setToken","JSON","stringify","user","now","toString","_error$response","_error$response2","_error$response2$data","errorMessage","networkError","login","credentials","redirectPath","getItem","_error$response3","_error$response4","_error$response5","_error$response5$data","verifyToken","substring","split","length","isAuthenticated","storedUserInfo","localUser","parse","e","_error$response6","_error$response7","getProfile","_error$response8","logout","post","checkAuthStatus","userInfo","authService"],"sources":["E:/AICode/StockInsight/frontend/src/services/authService.ts"],"sourcesContent":["/**\n * è®¤è¯æœåŠ¡\n * å¤„ç†ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€ä»¤ç‰Œç®¡ç†ç­‰åŠŸèƒ½\n * å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶\n */\n\nimport axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { message } from 'antd';\nimport { tokenManager } from './api';\n\n// è®¤è¯APIåŸºç¡€URL\n// const AUTH_API_URL = 'http://localhost:5000/api/auth';\n \n// å°†ç¡¬ç¼–ç URLæ”¹ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡\nconst AUTH_API_URL = process.env.REACT_APP_API_BASE_URL?.replace('/api', '/api/auth') || 'http://localhost:5000/api/auth';\n\n\n// æœ¬åœ°å­˜å‚¨é”®\nconst USER_INFO_KEY = 'userInfo';\nconst AUTH_LAST_VERIFIED_KEY = 'auth_last_verified';\n\n// é…ç½®å¸¸é‡\nconst REQUEST_TIMEOUT = 15000; // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\nconst MAX_RETRY_COUNT = 2; // æœ€å¤§é‡è¯•æ¬¡æ•°\nconst RETRY_DELAY = 1000; // é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰\n\n// åˆ›å»ºè®¤è¯ä¸“ç”¨çš„ axios å®ä¾‹\nconst authApi = axios.create({\n  baseURL: AUTH_API_URL,\n  timeout: REQUEST_TIMEOUT,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// è¯·æ±‚é‡è¯•å‡½æ•°\nconst retryAuthRequest = async (config: AxiosRequestConfig, retryCount: number = 0): Promise<AxiosResponse> => {\n  try {\n    return await axios(config);\n  } catch (error: any) {\n    // åªæœ‰åœ¨ç½‘ç»œé”™è¯¯æˆ–5xxæœåŠ¡å™¨é”™è¯¯æ—¶é‡è¯•\n    const isNetworkError = !error.response;\n    const isServerError = error.response && error.response.status >= 500;\n    \n    if ((isNetworkError || isServerError) && retryCount < MAX_RETRY_COUNT) {\n      console.log(`è®¤è¯è¯·æ±‚å¤±è´¥ï¼Œ${RETRY_DELAY/1000}ç§’åé‡è¯• (${retryCount + 1}/${MAX_RETRY_COUNT})`);\n      await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));\n      return retryAuthRequest(config, retryCount + 1);\n    }\n    \n    throw error;\n  }\n};\n\n// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ - è‡ªåŠ¨æ·»åŠ tokenåˆ°è¯·æ±‚å¤´\nauthApi.interceptors.request.use(\n  (config) => {\n    const token = tokenManager.getToken();\n    if (token) {\n      config.headers = config.headers || {};\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    \n    // æ·»åŠ è¯·æ±‚æ—¶é—´æˆ³ï¼Œç”¨äºè°ƒè¯•\n    config.headers = config.headers || {};\n    config.headers['X-Request-Time'] = new Date().toISOString();\n    \n    // è®°å½•è¯·æ±‚ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰\n    if (process.env.NODE_ENV === 'development') {\n      console.log(`ğŸ” è®¤è¯è¯·æ±‚: ${config.method?.toUpperCase()} ${config.url}`, {\n        headers: { ...config.headers, Authorization: token ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®' },\n        data: config.data,\n        params: config.params\n      });\n    }\n    \n    return config;\n  },\n  (error) => {\n    console.error('è®¤è¯è¯·æ±‚æ‹¦æˆªå™¨é”™è¯¯:', error);\n    return Promise.reject(error);\n  }\n);\n\n// æ·»åŠ å“åº”æ‹¦æˆªå™¨ - å¤„ç†tokenè¿‡æœŸ\nauthApi.interceptors.response.use(\n  (response) => {\n    // è®°å½•å“åº”ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰\n    if (process.env.NODE_ENV === 'development') {\n      console.log(`âœ… è®¤è¯å“åº”æˆåŠŸ: ${response.config.method?.toUpperCase()} ${response.config.url}`, {\n        status: response.status,\n        data: response.data\n      });\n    }\n    \n    return response;\n  },\n  (error: AxiosError) => {\n    // è·å–è¯·æ±‚é…ç½®å’Œå“åº”\n    const { config, response } = error;\n    \n    // è®°å½•é”™è¯¯ä¿¡æ¯ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰\n    if (process.env.NODE_ENV === 'development') {\n      console.error(`âŒ è®¤è¯è¯·æ±‚å¤±è´¥: ${config?.method?.toUpperCase()} ${config?.url}`, {\n        status: response?.status,\n        data: response?.data,\n        error: error.message\n      });\n    }\n    \n    // å¤„ç†401é”™è¯¯ï¼ˆæœªæˆæƒï¼Œé€šå¸¸æ˜¯tokenè¿‡æœŸæˆ–æ— æ•ˆï¼‰\n    if (response?.status === 401) {\n      console.warn('è®¤è¯è¯·æ±‚æ”¶åˆ°401æœªæˆæƒå“åº”');\n      \n      // æ¸…é™¤è®¤è¯ç›¸å…³æ•°æ®\n      tokenManager.removeToken();\n      localStorage.removeItem(USER_INFO_KEY);\n      localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      \n      // å¦‚æœä¸æ˜¯éªŒè¯æ¥å£çš„è¯·æ±‚ï¼Œæ˜¾ç¤ºæç¤ºå¹¶é‡å®šå‘\n      if (config?.url !== '/verify') {\n        message.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');\n        \n        // ä½¿ç”¨å»¶è¿Ÿé‡å®šå‘ï¼Œç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿæ˜¾ç¤º\n        setTimeout(() => {\n          // ä¿å­˜å½“å‰URLï¼Œä»¥ä¾¿ç™»å½•åè¿”å›\n          const currentPath = window.location.pathname;\n          if (currentPath !== '/login') {\n            sessionStorage.setItem('redirectAfterLogin', currentPath);\n          }\n          \n          window.location.href = '/login';\n        }, 1500);\n      }\n    }\n    \n    return Promise.reject(error);\n  }\n);\n\n// ç”¨æˆ·æ•°æ®ç±»å‹\nexport interface User {\n  id: number;\n  username: string;\n  email: string;\n  created_at: string;\n  last_login?: string;\n}\n\n// ç™»å½•è¯·æ±‚æ•°æ®\nexport interface LoginRequest {\n  username: string;\n  password: string;\n}\n\n// æ³¨å†Œè¯·æ±‚æ•°æ®\nexport interface RegisterRequest {\n  username: string;\n  email: string;\n  password: string;\n}\n\n// è®¤è¯å“åº”æ•°æ®\nexport interface AuthResponse {\n  user: User;\n  token: string; // åç«¯è¿”å›çš„æ˜¯tokenå­—æ®µï¼Œè€Œä¸æ˜¯access_token\n}\n\n// API å“åº”æ ¼å¼\nexport interface ApiResponse<T> {\n  success: boolean;\n  data?: T;\n  message?: string;\n  error?: string;\n  networkError?: boolean;\n}\n\n// è®¤è¯æœåŠ¡ç±»\nexport class AuthService {\n\n  /**\n   * ç”¨æˆ·æ³¨å†Œ\n   */\n  async register(userData: RegisterRequest): Promise<ApiResponse<AuthResponse>> {\n    try {\n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      const response = await retryAuthRequest({\n        method: 'post',\n        url: `${AUTH_API_URL}/register`,\n        data: userData,\n        headers: { 'Content-Type': 'application/json' }\n      });\n      \n      const data = response.data;\n\n      if (data.success && data.data) {\n        // ä¿å­˜ä»¤ç‰Œ - åç«¯è¿”å›çš„æ˜¯tokenå­—æ®µ\n        tokenManager.setToken(data.data.token);\n        \n        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯æ—¶é—´\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        \n        message.success('æ³¨å†ŒæˆåŠŸï¼');\n        return data;\n      } else {\n        message.error(data.message || 'æ³¨å†Œå¤±è´¥');\n        return data;\n      }\n    } catch (error: any) {\n      console.error('æ³¨å†Œå¤±è´¥:', error.response?.data || error.message);\n      \n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        const errorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';\n        message.error(errorMessage);\n        return {\n          success: false,\n          message: errorMessage,\n          networkError: true\n        };\n      }\n      \n      const errorMessage = error.response?.data?.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•';\n      message.error(errorMessage);\n      return {\n        success: false,\n        message: errorMessage,\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * ç”¨æˆ·ç™»å½•\n   */\n  async login(credentials: LoginRequest): Promise<ApiResponse<AuthResponse>> {\n    try {\n      console.log('å¼€å§‹ç™»å½•è¯·æ±‚:', credentials);\n      console.log('API URL:', AUTH_API_URL);\n      \n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      const response = await retryAuthRequest({\n        method: 'post',\n        url: `${AUTH_API_URL}/login`,\n        data: credentials,\n        headers: { 'Content-Type': 'application/json' }\n      });\n      \n      console.log('ç™»å½•å“åº”:', response.data);\n      \n      const data = response.data;\n\n      if (data.success && data.data) {\n        // ä¿å­˜ä»¤ç‰Œåˆ°localStorage - åç«¯è¿”å›çš„æ˜¯tokenå­—æ®µ\n        tokenManager.setToken(data.data.token);\n        \n        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯æ—¶é—´\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        \n        // æ£€æŸ¥æ˜¯å¦æœ‰ç™»å½•åé‡å®šå‘è·¯å¾„\n        const redirectPath = sessionStorage.getItem('redirectAfterLogin');\n        if (redirectPath) {\n          console.log(`ç™»å½•æˆåŠŸï¼Œå°†é‡å®šå‘åˆ°: ${redirectPath}`);\n          sessionStorage.removeItem('redirectAfterLogin');\n        }\n        \n        message.success('ç™»å½•æˆåŠŸï¼');\n        return data;\n      } else {\n        console.error('ç™»å½•å¤±è´¥:', data.message);\n        message.error(data.message || 'ç™»å½•å¤±è´¥');\n        return data;\n      }\n    } catch (error: any) {\n      console.error('ç™»å½•è¯·æ±‚å¼‚å¸¸:', error);\n      console.error('é”™è¯¯å“åº”:', error.response?.data);\n      \n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        const errorMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';\n        message.error(errorMessage);\n        return {\n          success: false,\n          message: errorMessage,\n          networkError: true\n        };\n      }\n      \n      // å¤„ç†ç‰¹å®šé”™è¯¯\n      if (error.response?.status === 401) {\n        const errorMessage = 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯';\n        message.error(errorMessage);\n        return {\n          success: false,\n          message: errorMessage,\n          error: error.message\n        };\n      }\n      \n      const errorMessage = error.response?.data?.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•';\n      message.error(errorMessage);\n      return {\n        success: false,\n        message: errorMessage,\n        error: error.message\n      };\n    }\n  }\n\n  /**\n   * éªŒè¯ä»¤ç‰Œ\n   */\n  async verifyToken(): Promise<{ success: boolean; user?: User; networkError?: boolean }> {\n    try {\n      const token = tokenManager.getToken();\n      if (!token) {\n        console.log('æ²¡æœ‰æ‰¾åˆ°tokenï¼Œæ— æ³•éªŒè¯');\n        return { success: false };\n      }\n\n      console.log('å¼€å§‹éªŒè¯token...', token.substring(0, 15) + '...');\n      console.log('Tokenæ ¼å¼æ£€æŸ¥:', token.split('.').length === 3 ? 'æœ‰æ•ˆ' : 'æ— æ•ˆ');\n      \n      // ç›´æ¥æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ\n      if (!tokenManager.isAuthenticated()) {\n        console.warn('æœ¬åœ°tokenéªŒè¯å¤±è´¥ï¼Œå¯èƒ½å·²è¿‡æœŸ');\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n        return { success: false };\n      }\n      \n      // æ£€æŸ¥æ˜¯å¦æœ‰æœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯\n      const storedUserInfo = localStorage.getItem(USER_INFO_KEY);\n      let localUser: User | null = null;\n      \n      if (storedUserInfo) {\n        try {\n          localUser = JSON.parse(storedUserInfo);\n          console.log('ä»æœ¬åœ°å­˜å‚¨æ¢å¤ç”¨æˆ·ä¿¡æ¯:', localUser);\n        } catch (e) {\n          console.error('è§£ææœ¬åœ°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);\n        }\n      }\n      \n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      console.log(`å‘é€éªŒè¯è¯·æ±‚åˆ°: ${AUTH_API_URL}/verify`);\n      const response = await retryAuthRequest({\n        method: 'get',\n        url: `${AUTH_API_URL}/verify`,\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        timeout: 5000 // é™ä½è¶…æ—¶æ—¶é—´ï¼ŒåŠ å¿«éªŒè¯é€Ÿåº¦\n      });\n      \n      // è¯·æ±‚æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨æ·»åŠ Authorizationå¤´\n      const data = response.data;\n      console.log('éªŒè¯å“åº”:', data);\n      \n      if (data.success && data.data && data.data.user) {\n        console.log('TokenéªŒè¯æˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯:', data.data.user);\n        \n        // æ›´æ–°éªŒè¯æ—¶é—´å’Œç”¨æˆ·ä¿¡æ¯\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        \n        return { success: true, user: data.data.user };\n      } else {\n        console.log('TokenéªŒè¯å¤±è´¥ï¼ŒæœåŠ¡å™¨è¿”å›:', data);\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n        return { success: false };\n      }\n    } catch (error: any) {\n      console.error('ä»¤ç‰ŒéªŒè¯å¤±è´¥:', error);\n      console.error('é”™è¯¯çŠ¶æ€ç :', error.response?.status);\n      console.error('é”™è¯¯è¯¦æƒ…:', error.response?.data);\n      \n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        console.warn('éªŒè¯token: ç½‘ç»œé”™è¯¯ï¼Œæ£€æŸ¥æœ¬åœ°ç”¨æˆ·ä¿¡æ¯');\n        \n        // ç½‘ç»œé”™è¯¯æ—¶ï¼Œå¦‚æœæœ‰æœ¬åœ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°è¯•ä½¿ç”¨æœ¬åœ°ä¿¡æ¯\n        const storedUserInfo = localStorage.getItem(USER_INFO_KEY);\n        if (storedUserInfo && tokenManager.isAuthenticated()) {\n          try {\n            const user = JSON.parse(storedUserInfo);\n            console.log('ç½‘ç»œé”™è¯¯ï¼Œä½¿ç”¨æœ¬åœ°ç”¨æˆ·ä¿¡æ¯:', user);\n            return {\n              success: true,\n              user: user,\n              networkError: true\n            };\n          } catch (e) {\n            console.error('è§£ææœ¬åœ°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);\n          }\n        }\n        \n        return {\n          success: false,\n          networkError: true\n        };\n      }\n      \n      // æ¸…é™¤æ— æ•ˆçš„tokenï¼ˆé™¤éæ˜¯ç½‘ç»œé”™è¯¯ï¼‰\n      if (!isNetworkError) {\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      }\n      \n      return { success: false };\n    }\n  }\n\n  /**\n   * è·å–ç”¨æˆ·èµ„æ–™\n   */\n  async getProfile(): Promise<{ success: boolean; user?: User; networkError?: boolean }> {\n    try {\n      const token = tokenManager.getToken();\n      if (!token) {\n        return { success: false };\n      }\n\n      // ä½¿ç”¨é‡è¯•æœºåˆ¶å‘é€è¯·æ±‚\n      const response = await retryAuthRequest({\n        method: 'get',\n        url: `${AUTH_API_URL}/profile`,\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      // è¯·æ±‚æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨æ·»åŠ Authorizationå¤´\n      const data = response.data;\n      \n      if (data.success && data.data && data.data.user) {\n        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯æ—¶é—´\n        localStorage.setItem(USER_INFO_KEY, JSON.stringify(data.data.user));\n        localStorage.setItem(AUTH_LAST_VERIFIED_KEY, Date.now().toString());\n        \n        return { success: true, user: data.data.user };\n      } else {\n        return { success: false };\n      }\n    } catch (error: any) {\n      console.error('è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', error);\n      \n      // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘ç»œé”™è¯¯\n      const isNetworkError = !error.response;\n      if (isNetworkError) {\n        return {\n          success: false,\n          networkError: true\n        };\n      }\n      \n      // å¦‚æœæ˜¯401é”™è¯¯ï¼Œæ¸…é™¤è®¤è¯çŠ¶æ€\n      if (error.response?.status === 401) {\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      }\n      \n      return { success: false };\n    }\n  }\n\n  /**\n   * ç”¨æˆ·ç™»å‡º\n   */\n  async logout(): Promise<{ success: boolean; message?: string }> {\n    try {\n      const token = tokenManager.getToken();\n      if (token) {\n        try {\n          // å¯é€‰ï¼šè°ƒç”¨åç«¯ç™»å‡ºæ¥å£\n          await authApi.post('/logout');\n          // æ³¨æ„ï¼šç”±äºæ·»åŠ äº†è¯·æ±‚æ‹¦æˆªå™¨ï¼Œè¿™é‡Œä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ Authorizationå¤´\n          console.log('æˆåŠŸè°ƒç”¨ç™»å‡ºAPI');\n        } catch (error) {\n          console.warn('ç™»å‡ºAPIè°ƒç”¨å¤±è´¥ï¼Œä½†ä¼šç»§ç»­æ¸…é™¤æœ¬åœ°çŠ¶æ€:', error);\n        }\n      }\n      \n      // æ— è®ºå¦‚ä½•éƒ½è¦æ¸…é™¤æœ¬åœ°ä»¤ç‰Œå’Œç”¨æˆ·ä¿¡æ¯\n      tokenManager.removeToken();\n      localStorage.removeItem(USER_INFO_KEY);\n      localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      \n      return { success: true, message: 'å·²å®‰å…¨é€€å‡ºç™»å½•' };\n    } catch (error: any) {\n      console.error('ç™»å‡ºè¿‡ç¨‹å‡ºé”™:', error);\n      \n      // å³ä½¿å‡ºé”™ï¼Œä¹Ÿè¦å°è¯•æ¸…é™¤æœ¬åœ°çŠ¶æ€\n      try {\n        tokenManager.removeToken();\n        localStorage.removeItem(USER_INFO_KEY);\n        localStorage.removeItem(AUTH_LAST_VERIFIED_KEY);\n      } catch (e) {\n        console.error('æ¸…é™¤æœ¬åœ°çŠ¶æ€å¤±è´¥:', e);\n      }\n      \n      return {\n        success: false,\n        message: 'ç™»å‡ºè¿‡ç¨‹å‡ºé”™ï¼Œä½†å·²æ¸…é™¤æœ¬åœ°ç™»å½•çŠ¶æ€'\n      };\n    }\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦å·²è®¤è¯\n   */\n  isAuthenticated(): boolean {\n    return tokenManager.isAuthenticated();\n  }\n  \n  /**\n   * æ£€æŸ¥è®¤è¯çŠ¶æ€ï¼ˆæœ¬åœ°æ£€æŸ¥ï¼Œä¸å‘é€ç½‘ç»œè¯·æ±‚ï¼‰\n   */\n  checkAuthStatus(): { isAuthenticated: boolean; user: User | null } {\n    const isAuthenticated = this.isAuthenticated();\n    let user: User | null = null;\n    \n    // å¦‚æœæœ‰tokenï¼Œå°è¯•ä»localStorageè·å–ç”¨æˆ·ä¿¡æ¯\n    if (isAuthenticated) {\n      try {\n        const userInfo = localStorage.getItem(USER_INFO_KEY);\n        if (userInfo) {\n          user = JSON.parse(userInfo);\n        }\n      } catch (e) {\n        console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);\n      }\n    }\n    \n    return { isAuthenticated, user };\n  }\n}\n\nexport const authService = new AuthService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}